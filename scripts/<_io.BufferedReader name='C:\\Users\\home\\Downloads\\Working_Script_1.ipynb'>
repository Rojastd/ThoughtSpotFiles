{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8e2bc131",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Enter the auth token for export : YmFuZGFydXNoaXZhbmk2MEBnbWFpbC5jb206SkhOb2FYSnZNU1JUU0VFdE1qVTJKRFV3TURBd01DUldSSE5pZFUxeFkwaG5SM1ZxTDB4aWExbEtOVEJCUFQwa2VtdGpSaXRoVlhoTVpYWmtUSE55U1RKSVpIVnljV0ZVVkZCYU5FeFZXR1F6WkVnd2RFNTJjM0JYWXow\n",
      "Enter the auth token for import : c2hpdmFuaS5iQGJsdWUuY2xvdWQ6SkhOb2FYSnZNU1JUU0VFdE1qVTJKRFV3TURBd01DUTBTMWRtVFc5TVRXcFNWakZvVVc5RVEwRkZSV3BCUFQwa2VUZHhNSFpDSzJwUlducGpXSEk1ZFc1UGIwOVZOV1JyTXpCb1JVd3dRVmhTVXpSdldXWjFlVUV5Y3ow\n",
      "Enter the url for export : https://my1.thoughtspot.cloud/api/rest/2.0/metadata/tml/export\n",
      "Enter the url for import : https://my1.thoughtspot.cloud/api/rest/2.0/metadata/tml/import\n",
      "enter the number:4\n",
      "Enter the guid : a8935bf4-f66b-4ef4-b83c-cd29f804fcd6\n",
      "Enter the guid : 6fcae077-85cf-4d6f-8cd5-043cf41d6786\n",
      "Enter the guid : 27463cd6-2fa3-41d7-b041-2e29a3b99182\n",
      "Enter the guid : 527e836e-239b-47a5-a316-5ceb5f54b3f1\n",
      "[{'identifier': 'a8935bf4-f66b-4ef4-b83c-cd29f804fcd6'}, {'identifier': '6fcae077-85cf-4d6f-8cd5-043cf41d6786'}, {'identifier': '27463cd6-2fa3-41d7-b041-2e29a3b99182'}, {'identifier': '527e836e-239b-47a5-a316-5ceb5f54b3f1'}]\n",
      "<Response [200]>\n",
      "[{\"response\":{\"header\":{\"author_guid\":\"3d95a653-495f-4db8-ae73-6912ab73e162\",\"id_guid\":\"e4345c4c-859f-4db1-9866-deed95fca90e\",\"metadata_type\":\"PINBOARD_ANSWER_BOOK\",\"owner_guid\":\"e4345c4c-859f-4db1-9866-deed95fca90e\",\"name\":\"Live1\",\"description\":\"\",\"lenient_discoverability\":false},\"status\":{\"error_message\":\"Viz_1 : GUID a9480514-6974-4d09-89a5-b723ac861aa4 is already being used by another object. New GUID will be used for viz. <br/>Viz_2 : GUID c172fcc6-7fb0-46d2-965c-790311dbcb86 is already being used by another object. New GUID will be used for viz. <br/><br/>Object with GUID a8935bf4-f66b-4ef4-b83c-cd29f804fcd6 already exists. New GUID will be used. <br/>\",\"status_code\":\"WARNING\"}}}]\n",
      "<Response [200]>\n",
      "[{\"response\":{\"header\":{\"author_guid\":\"3d95a653-495f-4db8-ae73-6912ab73e162\",\"id_guid\":\"feb600db-c3fa-4ef7-a561-8bfae0e04dab\",\"metadata_type\":\"PINBOARD_ANSWER_BOOK\",\"owner_guid\":\"feb600db-c3fa-4ef7-a561-8bfae0e04dab\",\"name\":\"Live2\",\"description\":\"\",\"lenient_discoverability\":false},\"status\":{\"error_message\":\"Viz_1 : GUID a11877bc-6d3f-4441-a348-7bddeeaa061e is already being used by another object. New GUID will be used for viz. <br/><br/>Object with GUID 6fcae077-85cf-4d6f-8cd5-043cf41d6786 already exists. New GUID will be used. <br/>\",\"status_code\":\"WARNING\"}}}]\n",
      "<Response [200]>\n",
      "[{\"response\":{\"header\":{\"author_guid\":\"3d95a653-495f-4db8-ae73-6912ab73e162\",\"id_guid\":\"93452a15-68f6-4b3b-8a59-e0733c5bcacf\",\"metadata_type\":\"PINBOARD_ANSWER_BOOK\",\"owner_guid\":\"93452a15-68f6-4b3b-8a59-e0733c5bcacf\",\"name\":\"Live3\",\"description\":\"\",\"lenient_discoverability\":false},\"status\":{\"error_message\":\"Viz_1 : GUID e993e9fd-7701-41d9-8ffd-d56a3a05345b is already being used by another object. New GUID will be used for viz. <br/><br/>Object with GUID 27463cd6-2fa3-41d7-b041-2e29a3b99182 already exists. New GUID will be used. <br/>\",\"status_code\":\"WARNING\"}}}]\n",
      "<Response [200]>\n",
      "[{\"response\":{\"header\":{\"author_guid\":\"3d95a653-495f-4db8-ae73-6912ab73e162\",\"id_guid\":\"d072e410-6a05-4b99-b89a-f1360f50a712\",\"metadata_type\":\"PINBOARD_ANSWER_BOOK\",\"owner_guid\":\"d072e410-6a05-4b99-b89a-f1360f50a712\",\"name\":\"Live4\",\"description\":\"\",\"lenient_discoverability\":false},\"status\":{\"error_message\":\"Viz_1 : GUID 997e95d7-c5a4-4051-95c8-c2daf21333b3 is already being used by another object. New GUID will be used for viz. <br/><br/>Object with GUID 527e836e-239b-47a5-a316-5ceb5f54b3f1 already exists. New GUID will be used. <br/>\",\"status_code\":\"WARNING\"}}}]\n"
     ]
    }
   ],
   "source": [
    "import requests\n",
    "import yaml\n",
    "import re\n",
    "\n",
    "ExportToken=input(\"Enter the auth token for export : \")\n",
    "ImportToken=input(\"Enter the auth token for import : \")\n",
    "Url_for_Export=input(\"Enter the url for export : \")\n",
    "Url_for_Import=input(\"Enter the url for import : \")\n",
    "\n",
    "headers = {\n",
    "    'Authorization': f'Bearer {ExportToken}',\n",
    "    'Accept': 'application/json',\n",
    "    'Content-Type': 'application/json',\n",
    "}\n",
    "\n",
    "str2 = []\n",
    "co=0\n",
    "\n",
    "exportvalue=[]\n",
    "def method3(str3):\n",
    "    if len(str3)==1:\n",
    "        b=str3[0]['edoc']\n",
    "    else:\n",
    "        for i in range(len(str3)):\n",
    "            if i == 0:\n",
    "                b = str3[i]['edoc']\n",
    "            else:\n",
    "                b = str(b) + '!'+ str(str3[i]['edoc'])\n",
    "#     print(b)\n",
    "    return b\n",
    "    \n",
    "def method1(co,sample):\n",
    "    str1 = sample \n",
    "    dict1 = {}\n",
    "    dict2 = {}\n",
    "    dict1.update({'identifier' : str1})\n",
    "    str2.append(dict1)\n",
    "#     print(str2)\n",
    "    return str2\n",
    "\n",
    "def method2(str2,Url_for_Export,ImportToken,Url_for_Import):\n",
    "    json_data = {\n",
    "        'metadata': str2,\n",
    "        'export_associated': False,\n",
    "        'export_fqn': False,\n",
    "    }\n",
    "\n",
    "    response = requests.post(url=Url_for_Export, headers=headers, json=json_data)\n",
    "#     print(response)\n",
    "#     print(response.text),Url_for_Export,ImportToken,Url_for_Import\n",
    "    \n",
    "    yaml_data = yaml.dump(response.json())\n",
    "    # print(yaml_data)\n",
    "\n",
    "    yaml_string = yaml_data\n",
    "\n",
    "    # Parse the YAML string\n",
    "    yaml_data2 = yaml.safe_load(yaml_string)\n",
    "    \n",
    "    solution=method3(yaml_data2)\n",
    "    \n",
    "    result=solution.split('!')\n",
    "#     print(result)\n",
    "#     print(len(result))\n",
    "    \n",
    "    headers2 = {\n",
    "    'Authorization': f'Bearer {ImportToken}',\n",
    "    'Accept': 'application/json',\n",
    "    'Content-Type': 'application/json',\n",
    "    }\n",
    "    for i in range(len(result)):\n",
    "        json_data = {\n",
    "            'metadata_tmls':result[i],\n",
    "            'import_policy': 'PARTIAL',\n",
    "            'create_new': False,\n",
    "        }\n",
    "\n",
    "        response = requests.post(url=Url_for_Import, headers=headers2, json=json_data)\n",
    "        print(response)\n",
    "        print(response.text)\n",
    "\n",
    "No_of_counts=int(input(\"enter the number:\"))\n",
    "\n",
    "for i in range(No_of_counts):\n",
    "    GUID=input(\"Enter the guid : \")\n",
    "    demo=method1(i,GUID)\n",
    "    \n",
    "returnvalue=demo\n",
    "    \n",
    "# method1(0,'a8935bf4-f66b-4ef4-b83c-cd29f804fcd6')\n",
    "# method1(1,'6fcae077-85cf-4d6f-8cd5-043cf41d6786')\n",
    "# method1(2,'27463cd6-2fa3-41d7-b041-2e29a3b99182')\n",
    "# method1(3,'527e836e-239b-47a5-a316-5ceb5f54b3f1')\n",
    "# method1(4,'6d8b4395-1f3a-4023-ae35-7de58ead008d')\n",
    "# method1(5,'e363a4f8-365b-471e-b747-9c6976555ad6')\n",
    "# returnvalue=method1(6,'3a1936ff-da27-495d-b4f3-b1c9e492d5d2')\n",
    "print(returnvalue)\n",
    "method2(returnvalue,Url_for_Export,ImportToken,Url_for_Import)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1425f207",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
